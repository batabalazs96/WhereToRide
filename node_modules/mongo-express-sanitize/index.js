'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var deleteMongoDbOjbect = function deleteMongoDbOjbect(json) {
  Object.keys(json).forEach(function (key) {
    if (key.charAt(0) === '$') {
      delete json[key];
    } else {
      try {
        var obj = JSON.parse(json[key]);
        if ((typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) === 'object' && Object.keys(obj).length > 0) {
          json[key] = deleteMongoDbOjbect(obj);
        }
      } catch (e) {}
    }
  });
  return json;
};

exports.default = function (option) {
  return function (req, res, next) {
    if (req.body && Object.keys(req.body).length > 0) {
      req.body = deleteMongoDbOjbect(req.body);
    }
    if (req.params && Object.keys(req.params).length > 0) {
      req.params = deleteMongoDbOjbect(req.params);
    }
    if (req.query && Object.keys(req.query).length > 0) {
      req.query = deleteMongoDbOjbect(req.query);
    }
    next();
  };
};